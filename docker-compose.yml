version: '3'
services:
    # DATASTORE SECTION
    datastore-writer:
        depends_on:
            - datastore-postgresql
            - message-bus
        environment:
            - DATASTORE_DATABASE_HOST=datastore-postgresql
            - DATASTORE_DATABASE_USER=openslides
            - DATASTORE_DATABASE_PASSWORD=openslides
            - DATASTORE_DATABASE_NAME=openslides
            - MESSAGE_BUS_HOST=message-bus
        networks:
            - datastore-postgresql
            - message-bus
        # test
        ports:
            - "127.0.0.1:8000:8000"
    datastore-postgresql:
        image: sameersbn/postgresql:10
        labels:
            org.openslides.role: "postgres"
        environment:
            - DB_USER=openslides
            - DB_PASS=openslides
            - DB_NAME=openslides
        networks:
            - datastore-postgresql

    # SHARED
    message-bus:
        image: redis:alpine
        networks:
            - message-bus
networks:
    datastore-postgresql:
    message-bus: