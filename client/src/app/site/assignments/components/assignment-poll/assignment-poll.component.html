<mat-card class="os-card" *ngIf="poll && showPoll()">
    <div class="assignment-poll-wrapper">
        <div class="assignment-poll-title-header">
            <mat-card-title>
                <a routerLink="/assignments/polls/{{ poll.id }}">
                    {{ poll.title }}
                </a>
            </mat-card-title>
            <div class="poll-properties">
                <mat-chip
                    *osPerms="'assignments.can_manage_polls'"
                    class="poll-state active"
                    [disableRipple]="true"
                    [matMenuTriggerFor]="triggerMenu"
                    [class]="poll.stateVerbose.toLowerCase()"
                    [ngClass]="{ disabled: !poll.getNextStates() }"
                >
                    {{ poll.stateVerbose | translate }}
                </mat-chip>
                <span *ngIf="poll.type !== 'analog'">
                    {{ poll.typeVerbose | translate }}
                </span>
            </div>
            <div class="poll-menu">
                <!-- Buttons -->
                <button
                    mat-icon-button
                    *osPerms="'assignments.motions.can_manage_polls';or: 'core.can_manage_projector'"
                    [matMenuTriggerFor]="pollItemMenu"
                    (click)="$event.stopPropagation()"
                >
                    <mat-icon>more_horiz</mat-icon>
                </button>
            </div>
        </div>

        <div *ngIf="hasVotes">
            <os-charts
                [type]="chartType"
                [labels]="candidatesLabels"
                [data]="chartDataSubject"
                [hasPadding]="false"
            ></os-charts>
        </div>
        <os-assignment-poll-vote *ngIf="poll.canBeVotedFor" [poll]="poll"></os-assignment-poll-vote>
        <div class="poll-detail-button-wrapper">
            <a mat-button routerLink="/assignments/polls/{{ poll.id }}">
                {{ 'More' | translate }}
            </a>
        </div>
    </div>
</mat-card>

<mat-menu #triggerMenu="matMenu">
    <ng-container *ngIf="poll">
        <button mat-menu-item (click)="changeState(state.value)" *ngFor="let state of poll.getNextStates() | keyvalue">
            <span translate>{{ state.key }}</span>
        </button>
    </ng-container>
</mat-menu>

<mat-menu #pollItemMenu="matMenu">
    <div *osPerms="'assignments.can_manage'">
        <button mat-menu-item (click)="openDialog()">
            <mat-icon>edit</mat-icon>
            <span translate>Edit</span>
        </button>
    </div>
    <div *osPerms="'core.can_manage_projector'">
        <os-projector-button menuItem="true" [object]="poll"></os-projector-button>
    </div>
    <div *osPerms="'assignments.can_manage'">
        <button mat-menu-item (click)="printBallot()">
            <mat-icon>picture_as_pdf</mat-icon>
            <span translate>Ballot paper</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item class="red-warning-text" (click)="onDeletePoll()">
            <mat-icon>delete</mat-icon>
            <span translate>Delete</span>
        </button>
    </div>
</mat-menu>
